* {
  box-sizing: border-box;
}

html,
body {
  margin: 0;
}

body {
  font-family: sans-serif;
}

[hidden] {
  display: none !important;
}

[disabled] {
  opacity: .5;
}

[\:if], [\:else], [\:each] {
  display: none!important;
}

@font-face {
  font-family: wavefont;
  font-display: block;
  src: url(./asset/wavefont.woff2) format('woff2');
}

.wavefont {
  display: block;
  --wght: 25;
  font-family: wavefont;
  /* letter-spacing: 1.5ch; */
  font-size: var(--wavefont-size, 50px);
  line-height: var(--wavefont-lh);
  font-variation-settings: 'wght' var(--wght), 'ROND' 100, 'YALN' 0;
  text-rendering: optimizeSpeed;
  font-smooth: grayscale;
  -webkit-font-smoothing: grayscale;
  -moz-osx-font-smoothing: grayscale;
}

.container {
  display: flex;
  position: relative;
  width: 100%;
  margin: 1rem auto;
  padding: 0 0 0;
  justify-content: center;
}

#wavearea {
  height: 100%;
  margin: 0;
  padding: 0 2vw;
  display: flex;
  flex-direction: column;
  /* --wavefont-size: max(4rem, min(10.8vw, 6rem)); */
  --wavefont-size: 50px;
  /* Value is special: it doesn't break in mobiles */
  --wavefont-lh: calc(var(--wavefont-size) * 1.4);
  --secondary: rgb(0 0 0 / 33%);
  --primary: black;

  #loading {
    cursor: wait !important;
  }

  #waveform {
    position: relative;
    width: 100%;
    /* this 0.5ch fixes inconsistent breaking, seemingly round error */
    max-width: calc(4 * 216 * 1ch + 0.5ch);
    margin: 0 1rem;
    margin-left: 4rem;
  }

  #waveform.dragover {
    /* cursor: drop; */
  }

  #editarea,
  #loader {
    outline: none;
    width: 100%;
    color: var(--primary);
  }

  #editarea {
    /* background-size: 1px calc(var(--wavefont-size) * 1.4);
    background-position: 0% 4.2rem;
    background-image:  repeating-linear-gradient(0deg, var(--secondary) -0.5px, rgb(255 255 255 / 0%) 0.5px, rgb(255 255 255 / 0%)); */
    position: relative;
    p::selection {
      background-color: var(--secondary);
    }
  }


  /* played samples dimmer */
  #editarea.playing:before,
  #editarea.playing:after {
    content: '';
    position: absolute;
    background: rgba(255, 255, 255, .75);
    pointer-events: none;
    z-index: 1;
  }

  #editarea:before {
    bottom: 0;
    left: -1px;
    right: -1px;
    top: calc(var(--carety) + var(--wavefont-lh));
  }

  #editarea:after {
    top: var(--carety);
    right: -1px;
    left: var(--caretx);
    height: var(--wavefont-lh);
  }

  #loader {
    top: 0;
    display: block;
    position: absolute;
    z-index: 1;
    pointer-events: none;
    color: var(--secondary);
  }


  .segment {
    position: relative;
    margin: 0;
    padding: 0;
    min-height: var(--wavefont-lh);

    word-break: break-all;
    white-space: break-spaces;
    line-break: anywhere;
  }

  #timecodes,
  #status {
    position: absolute;
    top: 0;
    left: -3rem;
    font-family: sans-serif;
    letter-spacing: 0;
    font-size: .75rem;
    margin: 0;
    word-break: keep-all;
    white-space: pre;
    color: var(--secondary);
    line-height: var(--wavefont-lh);
  }

  #timecodes {
    display: flex;
    flex-direction: column;
  }

  #timecodes>* {
    margin: 0;
    text-decoration: none;
    color: var(--secondary);
  }

  #status {
    left: -4rem;
  }

  #caret-line {
    position: absolute;
    margin-left: -3.8rem;
    width: 3rem;
    height: var(--wavefont-lh);
    top: var(--carety);
    display: flex;
    align-items: center;
    justify-content: center;
    pointer-events: none;
    margin-left: -4rem;
  }

  #floater {
    position: sticky;
    top: 0;
    bottom: var(--wavefont-lh);
    height: 0;
    display: flex;
    line-height: 0;
    /* margin-top: calc(-1*var(--wavefont-lh)); */

    #play {
      background: linear-gradient(to bottom, rgb(255 255 255 / 0%) 0%, rgb(255 255 255 / 100%) 25%, rgb(255 255 255 / 100%) 75%, rgb(255 255 255 / 0%) 100%);
      height: var(--wavefont-lh );
    }
  }

  #play {
    padding: 0;
    text-align: center;
    appearance: none;
    border: none;
    cursor: pointer;
    justify-content: center;
      align-items: center;
    -webkit-tap-highlight-color: transparent;
    z-index: 1;
    display: flex;
    background: none;

    #clickarea {
      height: calc(var(--wavefont-lh) * 3);
      width: 100%;
      position: absolute;
      top: -100%;

      height: 4rem;
      width: 4rem;
      position: absolute;
      left: -1rem;
      top: 0;
      bottom: 0;
      margin: auto;
    }
  }

  #playback {
    position: fixed;
    bottom: 4rem;
    width: auto;
    margin: auto;
    z-index: 2;
    display: flex;
    gap: .6rem;
    align-items: center;
    font-size: .8rem;
    padding: 1rem 1.2rem;
    border-radius: 50px;
    border: 1px solid rgb(0 0 0 / 3%);
    box-shadow: rgb(0 0 0 / 22%) 0px 4px 16px -8px, rgb(0 0 0 / 7%) 0px 1px 2px;
    background: linear-gradient(to bottom, rgb(255 255 255 / 95%) 0%, rgb(255 255 255 / 100%) 33%, rgb(255 255 255 / 100%) 100%);
    /* -webkit-backdrop-filter: blur(2px); */
    /* backdrop-filter: blur(2px); */

    .time {
      font-variant-numeric: tabular-nums;
    }
  }

  #krsnzd {
    position: fixed;
    bottom: 1.08rem;
    right: 1.08rem;
    margin: 0 auto;
    text-decoration: none;
    color: var(--primary);
    opacity: .108;
    transition: .108s ease-out;
  }

  #krsnzd:hover {
    opacity: .82;
  }

  #info-button {
    position: fixed;
    bottom: .8rem;
    right: .8rem;
    appearance: none;
    background: none;
    border: none;
    opacity: 0.25;
    cursor: pointer;
  }

  #info-button:hover {
    opacity: 1;
  }

  #info-dialog {
    padding: 1.2rem;
    border: none;
    border-radius: .8rem;
    box-shadow: rgb(0 0 0 / 22%) 0px 4px 16px -8px, rgb(0 0 0 / 7%) 0px 1px 2px;
    background: white;
    opacity: 0;
    display: none;
    transition: opacity .2s ease-out;
    inset: 0;
  }

  #info-dialog[open] {
    opacity: 1;
    margin: auto;
    display: block;
    transition: opacity .2s ease-out;
  }

  #info-dialog>* {
    margin: 0
  }

  #info-dialog::backdrop {
    background: rgba(108, 108, 108, .16);
    -webkit-backdrop-filter: blur(0px);
    backdrop-filter: blur(0px);
    transition: opacity .5s ease-out;
  }

  #info-dialog[open]::backdrop {
    -webkit-backdrop-filter: blur(4px);
    backdrop-filter: blur(4px);
  }


  #opener {
    nav {
      display: flex;
      flex-direction: row;
      gap: 1rem;
    }

    #file {
      width: 0.1px;
      height: 0.1px;
      opacity: 0;
      overflow: hidden;
      position: absolute;
      z-index: -1;
    }

    #file+label {
      display: flex;
      align-items: center;
      font-size: 1rem;
      cursor: pointer;
      user-select: none;
    }

    #record {
      align-items: center;
      padding: 0;
      text-align: center;
      display: flex;
      appearance: none;
      border: none;
      background: none;
      cursor: pointer;
      font-size: 1rem;
      user-select: none;
    }
  }

  /* Files list */
  #files {
    margin-top: 2rem;
    width: 100%;
    max-width: 600px;

    h3 {
      font-size: 0.875rem;
      font-weight: 600;
      margin: 0;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: #666;
    }

    select {
      padding: 0.25rem 0.5rem;
      border: 1px solid #e0e0e0;
      border-radius: 0.25rem;
      background: white;
      font-size: 0.75rem;
      cursor: pointer;

      &:hover {
        border-color: #d0d0d0;
      }
    }

    ul {
      list-style: none;
      padding: 0;
      margin: 0 -1rem;
    }

    li {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
    }

    .file-button {
      flex: 1;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.75rem 1rem;
      border-radius: 0.375rem;
      cursor: pointer;
      transition: all 0.2s;
      font-family: inherit;
      font-size: 0.875rem;
      text-align: left;

      &:hover {
        background: #e8e8e8;
        border-color: #d0d0d0;
      }

      &:active {
        transform: scale(0.98);
      }

      .file-name {
        font-weight: 500;
        color: #333;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      .file-date {
        color: #999;
        font-size: 0.75rem;
        white-space: nowrap;
        margin-left: 1rem;
      }
    }

    .delete-button {
      padding: 0.5rem;
      border-radius: 0.375rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
      flex-shrink: 0;

      &:hover {
        background: #fee;
        border-color: #fcc;
      }

      span {
        display: block;
        color: #666;
      }

      &:hover span {
        color: #c00;
      }
    }
  }
}
